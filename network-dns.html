<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.7. Domain Name System (DNS)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Handbook" /><link rel="up" href="network-servers.html" title="Chapter 29. Network Servers" /><link rel="prev" href="network-dhcp.html" title="29.6. Dynamic Host Configuration Protocol (DHCP)" /><link rel="next" href="network-apache.html" title="29.8. Apache HTTP Server" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="../../layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.7. Domain Name System (<acronym class="acronym">DNS</acronym>)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-dhcp.html">Prev</a> </td><th width="60%" align="center">Chapter 29. Network Servers</th><td width="20%" align="right"> <a accesskey="n" href="network-apache.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-dns"></a>29.7. Domain Name System (<acronym class="acronym">DNS</acronym>)</h2></div></div></div><a id="idp77013920" class="indexterm"></a><p>Domain Name System (<acronym class="acronym">DNS</acronym>) is the protocol
      through which domain names are mapped to <acronym class="acronym">IP</acronym>
      addresses, and vice versa.  <acronym class="acronym">DNS</acronym> is
      coordinated across the Internet through a somewhat complex
      system of authoritative root, Top Level Domain
      (<acronym class="acronym">TLD</acronym>), and other smaller-scale name servers,
      which host and cache individual domain information.  It is not
      necessary to run a name server to perform
      <acronym class="acronym">DNS</acronym> lookups on a system.</p><a id="idp77016864" class="indexterm"></a><p>In FreeBSD 10, the Berkeley Internet Name Domain
      (<acronym class="acronym">BIND</acronym>) has been removed from the base system
      and replaced with Unbound.  Unbound as configured in the FreeBSD
      Base is a local caching resolver.  <acronym class="acronym">BIND</acronym> is
      still available from The Ports Collection as <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/dns/bind99/pkg-descr">dns/bind99</a> or <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/dns/bind98/pkg-descr">dns/bind98</a>.  In FreeBSD 9 and lower,
      <acronym class="acronym">BIND</acronym> is included in FreeBSD Base.  The FreeBSD
      version provides enhanced security features, a new file system
      layout, and automated <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chroot</span>(8)</span></a> configuration.
      <acronym class="acronym">BIND</acronym> is maintained by the <a class="link" href="https://www.isc.org/" target="_top">Internet Systems
	Consortium</a>.</p><a id="idp77021600" class="indexterm"></a><a id="idp77022112" class="indexterm"></a><a id="idp77027104" class="indexterm"></a><p>The following table describes some of the terms associated
      with <acronym class="acronym">DNS</acronym>:</p><div class="table"><a id="idp77028384"></a><div class="table-title">Table 29.4. <acronym class="acronym">DNS</acronym> Terminology</div><div class="table-contents"><table summary="DNS Terminology" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody><tr><td>Forward <acronym class="acronym">DNS</acronym></td><td>Mapping of hostnames to <acronym class="acronym">IP</acronym>
	      addresses.</td></tr><tr><td>Origin</td><td>Refers to the domain covered in a particular zone
	      file.</td></tr><tr><td><span class="application">named</span>, BIND</td><td>Common names for the BIND name server package
	      within FreeBSD.</td></tr><tr><td>Resolver</td><td>A system process through which a machine queries
	      a name server for zone information.</td></tr><tr><td>Reverse <acronym class="acronym">DNS</acronym></td><td>Mapping of <acronym class="acronym">IP</acronym> addresses to
	      hostnames.</td></tr><tr><td>Root zone</td><td>The beginning of the Internet zone hierarchy.  All
	      zones fall under the root zone, similar to how all files
	      in a file system fall under the root directory.</td></tr><tr><td>Zone</td><td>An individual domain, subdomain, or portion of the
	      <acronym class="acronym">DNS</acronym> administered by the same
	      authority.</td></tr></tbody></table></div></div><br class="table-break" /><a id="idp77047200" class="indexterm"></a><p>Examples of zones:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="systemitem">.</code> is how the root zone is
	  usually referred to in documentation.</p></li><li class="listitem"><p><code class="systemitem">org.</code> is a Top Level Domain
	  (<acronym class="acronym">TLD</acronym>) under the root zone.</p></li><li class="listitem"><p><code class="systemitem">example.org.</code> is a zone
	  under the <code class="systemitem">org.</code>
	  <acronym class="acronym">TLD</acronym>.</p></li><li class="listitem"><p><code class="systemitem">1.168.192.in-addr.arpa</code> is a
	  zone referencing all <acronym class="acronym">IP</acronym> addresses which
	  fall under the <code class="systemitem">192.168.1.*</code>
	  <acronym class="acronym">IP</acronym> address space.</p></li></ul></div><p>As one can see, the more specific part of a hostname
      appears to its left.  For example, <code class="systemitem">example.org.</code> is more
      specific than <code class="systemitem">org.</code>, as
      <code class="systemitem">org.</code> is more specific than the root
      zone.  The layout of each part of a hostname is much like a file
      system: the <code class="filename">/dev</code> directory falls within the
      root, and so on.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77066272"></a>29.7.1. Reasons to Run a Name Server</h3></div></div></div><p>Name servers generally come in two forms: authoritative
	name servers, and caching (also known as resolving) name
	servers.</p><p>An authoritative name server is needed when:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>One wants to serve <acronym class="acronym">DNS</acronym> information
	    to the world, replying authoritatively to queries.</p></li><li class="listitem"><p>A domain, such as <code class="systemitem">example.org</code>, is
	    registered and <acronym class="acronym">IP</acronym> addresses need to be
	    assigned to hostnames under it.</p></li><li class="listitem"><p>An <acronym class="acronym">IP</acronym> address block requires
	    reverse <acronym class="acronym">DNS</acronym> entries
	    (<acronym class="acronym">IP</acronym> to hostname).</p></li><li class="listitem"><p>A backup or second name server, called a slave, will
	    reply to queries.</p></li></ul></div><p>A caching name server is needed when:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A local <acronym class="acronym">DNS</acronym> server may cache and
	    respond more quickly than querying an outside name
	    server.</p></li></ul></div><p>When one queries for <code class="systemitem">www.FreeBSD.org</code>, the
	resolver usually queries the uplink <acronym class="acronym">ISP</acronym>'s
	name server, and retrieves the reply.  With a local, caching
	<acronym class="acronym">DNS</acronym> server, the query only has to be made
	once to the outside world by the caching
	<acronym class="acronym">DNS</acronym> server.  Additional queries will not
	have to go outside the local network, since the information is
	cached locally.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77090336"></a>29.7.2. <acronym class="acronym">DNS</acronym> Server Configuration in FreeBSD 10.0
	and Later</h3></div></div></div><p>In FreeBSD 10.0, <span class="application">BIND</span> has been
	replaced with <span class="application">Unbound</span>.
	<span class="application">Unbound</span> is a validating caching
	resolver only.  If an authoritative server is needed, many are
	available from the Ports Collection.</p><p><span class="application">Unbound</span> is provided in the FreeBSD
	base system.  By default, it will provide
	<acronym class="acronym">DNS</acronym> resolution to the local machine only.
	While the base system package can be configured to provide
	resolution services beyond the local machine, it is
	recommended that such requirements be addressed by installing
	<span class="application">Unbound</span> from the FreeBSD Ports
	Collection.</p><p>To enable <span class="application">Unbound</span>, add the
	following to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">local_unbound_enable="YES"</pre><p>Any existing nameservers in
	<code class="filename">/etc/resolv.conf</code> will be configured as
	forwarders in the new <span class="application">Unbound</span>
	configuration.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If any of the listed nameservers do not support
	  <acronym class="acronym">DNSSEC</acronym>, local <acronym class="acronym">DNS</acronym>
	  resolution will fail.  Be sure to test each nameserver and
	  remove any that fail the test.  The following command will
	  show the trust tree or a failure for a nameserver running on
	  <code class="systemitem">192.168.1.1</code>:</p></div><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>drill -S FreeBSD.org @<em class="replaceable"><code>192.168.1.1</code></em></code></strong></pre><p>Once each nameserver is confirmed to support
	<acronym class="acronym">DNSSEC</acronym>, start
	<span class="application">Unbound</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service local_unbound onestart</code></strong></pre><p>This will take care of updating
	<code class="filename">/etc/resolv.conf</code> so that queries for
	<acronym class="acronym">DNSSEC</acronym> secured domains will now work.  For
	example, run the following to validate the FreeBSD.org
	<acronym class="acronym">DNSSEC</acronym> trust tree:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>drill -S FreeBSD.org</code></strong>
;; Number of trusted keys: 1
;; Chasing: freebsd.org. A

DNSSEC Trust tree:
freebsd.org. (A)
|---freebsd.org. (DNSKEY keytag: 36786 alg: 8 flags: 256)
    |---freebsd.org. (DNSKEY keytag: 32659 alg: 8 flags: 257)
    |---freebsd.org. (DS keytag: 32659 digest type: 2)
        |---org. (DNSKEY keytag: 49587 alg: 7 flags: 256)
            |---org. (DNSKEY keytag: 9795 alg: 7 flags: 257)
            |---org. (DNSKEY keytag: 21366 alg: 7 flags: 257)
            |---org. (DS keytag: 21366 digest type: 1)
            |   |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
            |       |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
            |---org. (DS keytag: 21366 digest type: 2)
                |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
                    |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
;; Chase successful</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77105184"></a>29.7.3. DNS Server Configuration in FreeBSD
	9.<em class="replaceable"><code>X</code></em> and Earlier</h3></div></div></div><p>In FreeBSD, the BIND daemon is called
	<span class="application">named</span>.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>File</th><th>Description</th></tr></thead><tbody><tr><td><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=named&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">named</span>(8)</span></a></td><td>The BIND daemon.</td></tr><tr><td><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rndc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rndc</span>(8)</span></a></td><td>Name server control utility.</td></tr><tr><td><code class="filename">/etc/namedb</code></td><td>Directory where BIND zone information
		resides.</td></tr><tr><td><code class="filename">/etc/namedb/named.conf</code></td><td>Configuration file of the daemon.</td></tr></tbody></table></div><p>Depending on how a given zone is configured on the server,
	the files related to that zone can be found in the
	<code class="filename">master</code>,
	<code class="filename">slave</code>, or
	<code class="filename">dynamic</code> subdirectories
	of the <code class="filename">/etc/namedb</code>
	directory.  These files contain the <acronym class="acronym">DNS</acronym>
	information that will be given out by the name server in
	response to queries.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77122720"></a>29.7.3.1. Starting BIND</h4></div></div></div><a id="idp77123360" class="indexterm"></a><p>Since BIND is installed by default, configuring it is
	relatively simple.</p><p>The default <span class="application">named</span> configuration
	is that of a basic resolving name server, running in a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chroot</span>(8)</span></a> environment, and restricted to listening on the
	local IPv4 loopback address (127.0.0.1).  To start the server
	one time with this configuration, use the following
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service named onestart</code></strong></pre><p>To ensure the <span class="application">named</span> daemon is
	started at boot each time, put the following line into the
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">named_enable="YES"</pre><p>There are many configuration options for
	<code class="filename">/etc/namedb/named.conf</code> that are beyond
	the scope of this document.  Other startup options
	for <span class="application">named</span> on FreeBSD can be found in
	the <code class="literal">named_<em class="replaceable"><code>*</code></em></code>
	flags in <code class="filename">/etc/defaults/rc.conf</code> and in
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.  The
	<a class="xref" href="configtuning-rcd.html" title="12.4. Managing Services in FreeBSD">Section 12.4, &#8220;Managing Services in FreeBSD&#8221;</a> section is also a good
	read.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77132448"></a>29.7.3.2. Configuration Files</h4></div></div></div><a id="idp77133088" class="indexterm"></a><p>Configuration files for <span class="application">named</span>
	currently reside in
	<code class="filename">/etc/namedb</code> directory
	and will need modification before use unless all that is
	needed is a simple resolver.  This is where most of the
	configuration will be performed.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77135392"></a>29.7.3.2.1. <code class="filename">/etc/namedb/named.conf</code></h5></div></div></div><pre class="programlisting">// $FreeBSD$
//
// Refer to the named.conf(5) and named(8) man pages, and the documentation
// in /usr/share/doc/bind9 for more details.
//
// If you are going to set up an authoritative server, make sure you
// understand the hairy details of how DNS works.  Even with
// simple mistakes, you can break connectivity for affected parties,
// or cause huge amounts of useless Internet traffic.

options {
	// All file and path names are relative to the chroot directory,
	// if any, and should be fully qualified.
	directory	"/etc/namedb/working";
	pid-file	"/var/run/named/pid";
	dump-file	"/var/dump/named_dump.db";
	statistics-file	"/var/stats/named.stats";

// If named is being used only as a local resolver, this is a safe default.
// For named to be accessible to the network, comment this option, specify
// the proper IP address, or delete this option.
	listen-on	{ 127.0.0.1; };

// If you have IPv6 enabled on this system, uncomment this option for
// use as a local resolver.  To give access to the network, specify
// an IPv6 address, or the keyword "any".
//	listen-on-v6	{ ::1; };

// These zones are already covered by the empty zones listed below.
// If you remove the related empty zones below, comment these lines out.
	disable-empty-zone "255.255.255.255.IN-ADDR.ARPA";
	disable-empty-zone "0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.IP6.ARPA";
	disable-empty-zone "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.IP6.ARPA";

// If you've got a DNS server around at your upstream provider, enter
// its IP address here, and enable the line below.  This will make you
// benefit from its cache, thus reduce overall DNS traffic in the Internet.
/*
	forwarders {
		127.0.0.1;
	};
*/

// If the 'forwarders' clause is not empty the default is to 'forward first'
// which will fall back to sending a query from your local server if the name
// servers in 'forwarders' do not have the answer.  Alternatively you can
// force your name server to never initiate queries of its own by enabling the
// following line:
//	forward only;

// If you wish to have forwarding configured automatically based on
// the entries in /etc/resolv.conf, uncomment the following line and
// set named_auto_forward=yes in /etc/rc.conf.  You can also enable
// named_auto_forward_only (the effect of which is described above).
//	include "/etc/namedb/auto_forward.conf";</pre><p>Just as the comment says, to benefit from an uplink's
	  cache, <code class="literal">forwarders</code> can be enabled here.
	  Under normal circumstances, a name server will recursively
	  query the Internet looking at certain name servers until it
	  finds the answer it is looking for.  Having this enabled
	  will have it query the uplink's name server (or name server
	  provided) first, taking advantage of its cache.  If the
	  uplink name server in question is a heavily trafficked, fast
	  name server, enabling this may be worthwhile.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="systemitem">127.0.0.1</code>
	    will <span class="emphasis"><em>not</em></span> work here.  Change this
	    <acronym class="acronym">IP</acronym> address to a name server at the
	    uplink.</p></div><pre class="programlisting">	/*
	   Modern versions of BIND use a random <acronym class="acronym">UDP</acronym> port for each outgoing
	   query by default in order to dramatically reduce the possibility
	   of cache poisoning.  All users are strongly encouraged to utilize
	   this feature, and to configure their firewalls to accommodate it.

	   AS A LAST RESORT in order to get around a restrictive firewall
	   policy you can try enabling the option below.  Use of this option
	   will significantly reduce your ability to withstand cache poisoning
	   attacks, and should be avoided if at all possible.

	   Replace NNNNN in the example with a number between 49160 and 65530.
	*/
	// query-source address * port NNNNN;
};

// If you enable a local name server, don't forget to enter 127.0.0.1
// first in your /etc/resolv.conf so this server will be queried.
// Also, make sure to enable it in /etc/rc.conf.

// The traditional root hints mechanism. Use this, OR the slave zones below.
zone "." { type hint; file "/etc/namedb/named.root"; };

/*	Slaving the following zones from the root name servers has some
	significant advantages:
	1. Faster local resolution for your users
	2. No spurious traffic will be sent from your network to the roots
	3. Greater resilience to any potential root server failure/DDoS

	On the other hand, this method requires more monitoring than the
	hints file to be sure that an unexpected failure mode has not
	incapacitated your server.  Name servers that are serving a lot
	of clients will benefit more from this approach than individual
	hosts.  Use with caution.

	To use this mechanism, uncomment the entries below, and comment
	the hint zone above.

	As documented at http://dns.icann.org/services/axfr/ these zones:
	"." (the root), ARPA, IN-ADDR.ARPA, IP6.ARPA, and ROOT-SERVERS.NET
	are available for AXFR from these servers on IPv4 and IPv6:
	xfr.lax.dns.icann.org, xfr.cjr.dns.icann.org
*/
/*
zone "." {
	type slave;
	file "/etc/namedb/slave/root.slave";
	masters {
		192.5.5.241;	// F.ROOT-SERVERS.NET.
	};
	notify no;
};
zone "arpa" {
	type slave;
	file "/etc/namedb/slave/arpa.slave";
	masters {
		192.5.5.241;	// F.ROOT-SERVERS.NET.
	};
	notify no;
};
*/

/*	Serving the following zones locally will prevent any queries
	for these zones leaving your network and going to the root
	name servers.  This has two significant advantages:
	1. Faster local resolution for your users
	2. No spurious traffic will be sent from your network to the roots
*/
// RFCs 1912 and 5735 (and BCP 32 for localhost)
zone "localhost"	{ type master; file "/etc/namedb/master/localhost-forward.db"; };
zone "127.in-addr.arpa"	{ type master; file "/etc/namedb/master/localhost-reverse.db"; };
zone "255.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };

// RFC 1912-style zone for IPv6 localhost address
zone "0.ip6.arpa"	{ type master; file "/etc/namedb/master/localhost-reverse.db"; };

// "This" Network (RFCs 1912 and 5735)
zone "0.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };

// Private Use Networks (RFCs 1918 and 5735)
zone "10.in-addr.arpa"	   { type master; file "/etc/namedb/master/empty.db"; };
zone "16.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "17.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "18.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "19.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "20.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "21.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "22.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "23.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "24.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "25.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "26.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "27.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "28.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "29.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "30.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "31.172.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "168.192.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };

// Link-local/APIPA (RFCs 3927 and 5735)
zone "254.169.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };

// IETF protocol assignments (RFCs 5735 and 5736)
zone "0.0.192.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };

// TEST-NET-[1-3] for Documentation (RFCs 5735 and 5737)
zone "2.0.192.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "100.51.198.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "113.0.203.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };

// IPv6 Range for Documentation (RFC 3849)
zone "8.b.d.0.1.0.0.2.ip6.arpa" { type master; file "/etc/namedb/master/empty.db"; };

// Domain Names for Documentation and Testing (BCP 32)
zone "test" { type master; file "/etc/namedb/master/empty.db"; };
zone "example" { type master; file "/etc/namedb/master/empty.db"; };
zone "invalid" { type master; file "/etc/namedb/master/empty.db"; };
zone "example.com" { type master; file "/etc/namedb/master/empty.db"; };
zone "example.net" { type master; file "/etc/namedb/master/empty.db"; };
zone "example.org" { type master; file "/etc/namedb/master/empty.db"; };

// Router Benchmark Testing (RFCs 2544 and 5735)
zone "18.198.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };
zone "19.198.in-addr.arpa" { type master; file "/etc/namedb/master/empty.db"; };

// IANA Reserved - Old Class E Space (RFC 5735)
zone "240.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "241.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "242.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "243.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "244.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "245.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "246.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "247.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "248.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "249.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "250.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "251.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "252.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "253.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "254.in-addr.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };

// IPv6 Unassigned Addresses (RFC 4291)
zone "1.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "3.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "4.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "5.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "6.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "7.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "8.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "9.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "a.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "b.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "c.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "d.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "e.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "0.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "1.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "2.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "3.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "4.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "5.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "6.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "7.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "8.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "9.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "a.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "b.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "0.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "1.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "2.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "3.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "4.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "5.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "6.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "7.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };

// IPv6 ULA (RFC 4193)
zone "c.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "d.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };

// IPv6 Link Local (RFC 4291)
zone "8.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "9.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "a.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "b.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };

// IPv6 Deprecated Site-Local Addresses (RFC 3879)
zone "c.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "d.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "e.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };
zone "f.e.f.ip6.arpa"	{ type master; file "/etc/namedb/master/empty.db"; };

// IP6.INT is Deprecated (RFC 4159)
zone "ip6.int"		{ type master; file "/etc/namedb/master/empty.db"; };

// NB: Do not use the IP addresses below, they are faked, and only
// serve demonstration/documentation purposes!
//
// Example slave zone config entries.  It can be convenient to become
// a slave at least for the zone your own domain is in.  Ask
// your network administrator for the IP address of the responsible
// master name server.
//
// Do not forget to include the reverse lookup zone!
// This is named after the first bytes of the IP address, in reverse
// order, with ".IN-ADDR.ARPA" appended, or ".IP6.ARPA" for IPv6.
//
// Before starting to set up a master zone, make sure you fully
// understand how DNS and BIND work.  There are sometimes
// non-obvious pitfalls.  Setting up a slave zone is usually simpler.
//
// NB: Don't blindly enable the examples below. :-)  Use actual names
// and addresses instead.

/* An example dynamic zone
key "exampleorgkey" {
	algorithm hmac-md5;
	secret "sf87HJqjkqh8ac87a02lla==";
};
zone "example.org" {
	type master;
	allow-update {
		key "exampleorgkey";
	};
	file "/etc/namedb/dynamic/example.org";
};
*/

/* Example of a slave reverse zone
zone "1.168.192.in-addr.arpa" {
	type slave;
	file "/etc/namedb/slave/1.168.192.in-addr.arpa";
	masters {
		192.168.1.1;
	};
};
*/</pre><p>In <code class="filename">named.conf</code>, these are examples
	  of slave entries for a forward and reverse zone.</p><p>For each new zone served, a new zone entry must be added
	  to <code class="filename">named.conf</code>.</p><p>For example, the simplest zone entry for
	  <code class="systemitem">example.org</code>
	  can look like:</p><pre class="programlisting">zone "example.org" {
	type master;
	file "master/example.org";
};</pre><p>The zone is a master, as indicated by the
	  <code class="option">type</code> statement, holding its zone
	  information in
	  <code class="filename">/etc/namedb/master/example.org</code>
	  indicated by the <code class="option">file</code> statement.</p><pre class="programlisting">zone "example.org" {
	type slave;
	file "slave/example.org";
};</pre><p>In the slave case, the zone information is transferred
	  from the master name server for the particular zone, and
	  saved in the file specified.  If and when the master server
	  dies or is unreachable, the slave name server will have the
	  transferred zone information and will be able to serve
	  it.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77252000"></a>29.7.3.2.2. Zone Files</h5></div></div></div><a id="idp77252640" class="indexterm"></a><p>An example master zone file for <code class="systemitem">example.org</code> (existing
	  within <code class="filename">/etc/namedb/master/example.org</code>)
	  is as follows:</p><pre class="programlisting">$TTL 3600        ; 1 hour default TTL
example.org.    IN      SOA      ns1.example.org. admin.example.org. (
                                2006051501      ; Serial
                                10800           ; Refresh
                                3600            ; Retry
                                604800          ; Expire
                                300             ; Negative Response TTL
                        )

; DNS Servers
                IN      NS      ns1.example.org.
                IN      NS      ns2.example.org.

; MX Records
                IN      MX 10   mx.example.org.
                IN      MX 20   mail.example.org.

                IN      A       192.168.1.1

; Machine Names
localhost       IN      A       127.0.0.1
ns1             IN      A       192.168.1.2
ns2             IN      A       192.168.1.3
mx              IN      A       192.168.1.4
mail            IN      A       192.168.1.5

; Aliases
www             IN      CNAME   example.org.</pre><p>Note that every hostname ending in a <span class="quote">&#8220;<span class="quote">.</span>&#8221;</span> is
	  an exact hostname, whereas everything without a trailing
	  <span class="quote">&#8220;<span class="quote">.</span>&#8221;</span> is relative to the origin.  For example,
	  <code class="literal">ns1</code> is translated into
	  <code class="literal">ns1.<em class="replaceable"><code>example.org.</code></em></code></p><p>The format of a zone file follows:</p><pre class="programlisting">recordname      IN recordtype   value</pre><a id="idp77258272" class="indexterm"></a><p>The most commonly used <acronym class="acronym">DNS</acronym>
	  records:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">SOA</span></dt><dd><p>start of zone authority</p></dd><dt><span class="term">NS</span></dt><dd><p>an authoritative name server</p></dd><dt><span class="term">A</span></dt><dd><p>a host address</p></dd><dt><span class="term">CNAME</span></dt><dd><p>the canonical name for an
	      alias</p></dd><dt><span class="term">MX</span></dt><dd><p>mail exchanger</p></dd><dt><span class="term">PTR</span></dt><dd><p>a domain name pointer (used in reverse
		<acronym class="acronym">DNS</acronym>)</p></dd></dl></div><pre class="programlisting">example.org. IN SOA ns1.example.org. admin.example.org. (
                        2006051501      ; Serial
                        10800           ; Refresh after 3 hours
                        3600            ; Retry after 1 hour
                        604800          ; Expire after 1 week
                        300 )           ; Negative Response TTL</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="systemitem">example.org.</code></span></dt><dd><p>the domain name, also the origin for this
		zone file.</p></dd><dt><span class="term"><code class="systemitem">ns1.example.org.</code></span></dt><dd><p>the primary/authoritative name server for this
		zone.</p></dd><dt><span class="term"><code class="literal">admin.example.org.</code></span></dt><dd><p>the responsible person for this zone,
		email address with <span class="quote">&#8220;<span class="quote">@</span>&#8221;</span>
		replaced.  (<code class="email">&lt;<a xmlns="" class="email" href="mailto:admin@example.org">admin@example.org</a>&gt;</code> becomes
		<code class="literal">admin.example.org</code>)</p></dd><dt><span class="term"><code class="literal">2006051501</code></span></dt><dd><p>the serial number of the file.  This must be
		incremented each time the zone file is modified.
		Nowadays, many admins prefer a
		<code class="literal">yyyymmddrr</code> format for the serial
		number.  <code class="literal">2006051501</code> would mean last
		modified 05/15/2006, the latter <code class="literal">01</code>
		being the first time the zone file has been modified
		this day.  The serial number is important as it alerts
		slave name servers for a zone when it is
		updated.</p></dd></dl></div><pre class="programlisting">       IN NS           ns1.example.org.</pre><p>This is an NS entry.  Every name server that is going to
	  reply authoritatively for the zone must have one of these
	  entries.</p><pre class="programlisting">localhost       IN      A       127.0.0.1
ns1             IN      A       192.168.1.2
ns2             IN      A       192.168.1.3
mx              IN      A       192.168.1.4
mail            IN      A       192.168.1.5</pre><p>The A record indicates machine names.  As seen above,
	  <code class="systemitem">ns1.example.org</code> would
	  resolve to <code class="systemitem">192.168.1.2</code>.</p><pre class="programlisting">                IN      A       192.168.1.1</pre><p>This line assigns <acronym class="acronym">IP</acronym> address
	  <code class="systemitem">192.168.1.1</code> to
	  the current origin, in this case <code class="systemitem">example.org</code>.</p><pre class="programlisting">www             IN CNAME        @</pre><p>The canonical name record is usually used for giving
	  aliases to a machine.  In the example,
	  <code class="systemitem">www</code> is aliased to the
	  <span class="quote">&#8220;<span class="quote">master</span>&#8221;</span> machine whose name happens to be the
	  same as the domain name <code class="systemitem">example.org</code>
	  (<code class="systemitem">192.168.1.1</code>).
	  CNAMEs can never be used together with another kind of
	  record for the same hostname.</p><a id="idp77295136" class="indexterm"></a><pre class="programlisting">               IN MX   10      mail.example.org.</pre><p>The MX record indicates which mail servers are
	  responsible for handling incoming mail for the zone.
	  <code class="systemitem">mail.example.org</code> is the
	  hostname of a mail server, and 10 is the priority of that
	  mail server.</p><p>One can have several mail servers, with priorities of
	  10, 20 and so on.  A mail server attempting to deliver to
	  <code class="systemitem">example.org</code>
	  would first try the highest priority MX (the record with the
	  lowest priority number), then the second highest, etc, until
	  the mail can be properly delivered.</p><p>For in-addr.arpa zone files (reverse
	  <acronym class="acronym">DNS</acronym>), the same format is used, except
	  with PTR entries instead of A or CNAME.</p><pre class="programlisting">$TTL 3600

1.168.192.in-addr.arpa. IN SOA ns1.example.org. admin.example.org. (
                        2006051501      ; Serial
                        10800           ; Refresh
                        3600            ; Retry
                        604800          ; Expire
                        300 )           ; Negative Response TTL

        IN      NS      ns1.example.org.
        IN      NS      ns2.example.org.

1       IN      PTR     example.org.
2       IN      PTR     ns1.example.org.
3       IN      PTR     ns2.example.org.
4       IN      PTR     mx.example.org.
5       IN      PTR     mail.example.org.</pre><p>This file gives the proper <acronym class="acronym">IP</acronym> address
	  to hostname mappings for the above fictitious domain.</p><p>It is worth noting that all names on the right side
	  of a PTR record need to be fully qualified (i.e., end in
	  a <span class="quote">&#8220;<span class="quote">.</span>&#8221;</span>).</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77301408"></a>29.7.3.3. Caching Name Server</h4></div></div></div><a id="idp77302048" class="indexterm"></a><p>A caching name server is a name server whose primary role
	is to resolve recursive queries.  It simply asks queries of
	its own, and remembers the answers for later use.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77303712"></a>29.7.3.4. <acronym class="acronym">DNSSEC</acronym></h4></div></div></div><a id="idp77304608" class="indexterm"></a><p>Domain Name System Security Extensions, or <acronym class="acronym">DNSSEC</acronym> for
	short, is a suite of specifications to protect resolving name
	servers from forged <acronym class="acronym">DNS</acronym> data, such as
	spoofed <acronym class="acronym">DNS</acronym> records.  By using digital
	signatures, a resolver can verify the integrity of the record.
	Note that <acronym class="acronym">DNSSEC</acronym> only provides integrity via
	digitally signing the Resource Records (<acronym class="acronym">RR</acronym>s).  It provides neither
	confidentiality nor protection against false end-user
	assumptions.  This means that it cannot protect against people
	going to <code class="systemitem">example.net</code> instead of
	<code class="systemitem">example.com</code>.
	The only thing <acronym class="acronym">DNSSEC</acronym> does is authenticate
	that the data has not been compromised in transit.  The
	security of <acronym class="acronym">DNS</acronym> is an important step in
	securing the Internet in general.  For more in-depth details
	of how <acronym class="acronym">DNSSEC</acronym> works, the relevant
	<acronym class="acronym">RFC</acronym>s are a good place to start.  See the
	list in <a class="xref" href="network-dns.html#dns-read" title="29.7.3.6. Further Reading">Section 29.7.3.6, &#8220;Further Reading&#8221;</a>.</p><p>The following sections will demonstrate how to enable
	<acronym class="acronym">DNSSEC</acronym> for an authoritative
	<acronym class="acronym">DNS</acronym> server and a recursive (or caching)
	<acronym class="acronym">DNS</acronym> server running <acronym class="acronym">BIND</acronym>
	9.  While all versions of <acronym class="acronym">BIND</acronym> 9 support
	<acronym class="acronym">DNSSEC</acronym>, it is necessary to have at least
	version 9.6.2 in order to be able to use the signed root zone
	when validating <acronym class="acronym">DNS</acronym> queries.  This is
	because earlier versions lack the required algorithms to
	enable validation using the root zone key.  It is strongly
	recommended to use the latest version of
	<acronym class="acronym">BIND</acronym> 9.7 or later to take advantage of
	automatic key updating for the root key, as well as other
	features to automatically keep zones signed and signatures up
	to date.  Where configurations differ between 9.6.2 and 9.7
	and later, differences will be pointed out.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77319456"></a>29.7.3.4.1. Recursive <acronym class="acronym">DNS</acronym> Server
	  Configuration</h5></div></div></div><p>Enabling <acronym class="acronym">DNSSEC</acronym> validation of queries
	  performed by a recursive <acronym class="acronym">DNS</acronym> server
	  requires a few changes to <code class="filename">named.conf</code>.
	  Before making these changes the root zone key, or trust
	  anchor, must be acquired.  Currently the root zone key is
	  not available in a file format <acronym class="acronym">BIND</acronym>
	  understands, so it has to be manually converted into the
	  proper format.  The key itself can be obtained by querying
	  the root zone for it using <span class="application">dig</span>.
	  By running</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dig +multi +noall +answer DNSKEY . &gt; root.dnskey</code></strong></pre><p>the key will end up in <code class="filename">root.dnskey</code>.
	  The contents should look something like this:</p><pre class="programlisting">. 93910 IN DNSKEY 257 3 8 (
	AwEAAagAIKlVZrpC6Ia7gEzahOR+9W29euxhJhVVLOyQ
	bSEW0O8gcCjFFVQUTf6v58fLjwBd0YI0EzrAcQqBGCzh
	/RStIoO8g0NfnfL2MTJRkxoXbfDaUeVPQuYEhg37NZWA
	JQ9VnMVDxP/VHL496M/QZxkjf5/Efucp2gaDX6RS6CXp
	oY68LsvPVjR0ZSwzz1apAzvN9dlzEheX7ICJBBtuA6G3
	LQpzW5hOA2hzCTMjJPJ8LbqF6dsV6DoBQzgul0sGIcGO
	Yl7OyQdXfZ57relSQageu+ipAdTTJ25AsRTAoub8ONGc
	LmqrAmRLKBP1dfwhYB4N7knNnulqQxA+Uk1ihz0=
	) ; key id = 19036
. 93910 IN DNSKEY 256 3 8 (
	AwEAAcaGQEA+OJmOzfzVfoYN249JId7gx+OZMbxy69Hf
	UyuGBbRN0+HuTOpBxxBCkNOL+EJB9qJxt+0FEY6ZUVjE
	g58sRr4ZQ6Iu6b1xTBKgc193zUARk4mmQ/PPGxn7Cn5V
	EGJ/1h6dNaiXuRHwR+7oWh7DnzkIJChcTqlFrXDW3tjt
) ; key id = 34525</pre><p>Do not be alarmed if the obtained keys differ from this
	  example.  They might have changed since these instructions
	  were last updated.  This output actually contains two keys.
	  The first key in the listing, with the value 257 after the
	  DNSKEY record type, is the one needed.  This value indicates
	  that this is a Secure Entry Point
	  (<acronym class="acronym">SEP</acronym>), commonly
	  known as a Key Signing Key
	  (<acronym class="acronym">KSK</acronym>).  The second
	  key, with value 256, is a subordinate key, commonly called a
	  Zone Signing Key
	  (<acronym class="acronym">ZSK</acronym>).  More on
	  the different key types later in
	  <a class="xref" href="network-dns.html#dns-dnssec-auth" title="29.7.3.4.2. Authoritative DNS Server Configuration">Section 29.7.3.4.2, &#8220;Authoritative <acronym class="acronym">DNS</acronym> Server
	  Configuration&#8221;</a>.</p><p>Now the key must be verified and formatted so that
	  <acronym class="acronym">BIND</acronym> can use it.  To verify the key,
	  generate a <acronym class="acronym">DS</acronym>
	  <acronym class="acronym">RR</acronym> set.  Create a
	  file containing these
	  <acronym class="acronym">RR</acronym>s with</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dnssec-dsfromkey -f root.dnskey . &gt; root.ds</code></strong></pre><p>These records use SHA-1 and SHA-256 respectively, and
	  should look similar to the following example, where the
	  longer is using SHA-256.</p><pre class="programlisting">.  IN DS 19036 8 1
	B256BD09DC8DD59F0E0F0D8541B8328DD986DF6E
. IN DS 19036 8 2 49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5</pre><p>The SHA-256 <acronym class="acronym">RR</acronym> can now be compared to
	  the digest in <a class="link" href="https://data.iana.org/root-anchors/root-anchors.xml" target="_top">https://data.iana.org/root-anchors/root-anchors.xml</a>.
	  To be absolutely sure that the key has not been tampered
	  with the data in the <acronym class="acronym">XML</acronym> file can be
	  verified using the <acronym class="acronym">PGP</acronym> signature in
	  <a class="link" href="https://data.iana.org/root-anchors/root-anchors.asc" target="_top">https://data.iana.org/root-anchors/root-anchors.asc</a>.</p><p>Next, the key must be formatted properly.  This differs
	  a little between <acronym class="acronym">BIND</acronym> versions 9.6.2 and
	  9.7 and later.  In version 9.7 support was added to
	  automatically track changes to the key and update it as
	  necessary.  This is done using
	  <code class="literal">managed-keys</code> as seen in the example
	  below.  When using the older version, the key is added using
	  a <code class="literal">trusted-keys</code> statement and updates must
	  be done manually.  For <acronym class="acronym">BIND</acronym> 9.6.2 the
	  format should look like:</p><pre class="programlisting">trusted-keys {
	"." 257 3 8
	"AwEAAagAIKlVZrpC6Ia7gEzahOR+9W29euxhJhVVLOyQbSEW0O8gcCjF
	FVQUTf6v58fLjwBd0YI0EzrAcQqBGCzh/RStIoO8g0NfnfL2MTJRkxoX
	bfDaUeVPQuYEhg37NZWAJQ9VnMVDxP/VHL496M/QZxkjf5/Efucp2gaD
	X6RS6CXpoY68LsvPVjR0ZSwzz1apAzvN9dlzEheX7ICJBBtuA6G3LQpz
	W5hOA2hzCTMjJPJ8LbqF6dsV6DoBQzgul0sGIcGOYl7OyQdXfZ57relS
	Qageu+ipAdTTJ25AsRTAoub8ONGcLmqrAmRLKBP1dfwhYB4N7knNnulq
	QxA+Uk1ihz0=";
};</pre><p>For 9.7 the format will instead be:</p><pre class="programlisting">managed-keys {
	"." initial-key 257 3 8
	"AwEAAagAIKlVZrpC6Ia7gEzahOR+9W29euxhJhVVLOyQbSEW0O8gcCjF
	FVQUTf6v58fLjwBd0YI0EzrAcQqBGCzh/RStIoO8g0NfnfL2MTJRkxoX
	bfDaUeVPQuYEhg37NZWAJQ9VnMVDxP/VHL496M/QZxkjf5/Efucp2gaD
	X6RS6CXpoY68LsvPVjR0ZSwzz1apAzvN9dlzEheX7ICJBBtuA6G3LQpz
	W5hOA2hzCTMjJPJ8LbqF6dsV6DoBQzgul0sGIcGOYl7OyQdXfZ57relS
	Qageu+ipAdTTJ25AsRTAoub8ONGcLmqrAmRLKBP1dfwhYB4N7knNnulq
	QxA+Uk1ihz0=";
};</pre><p>The root key can now be added to
	  <code class="filename">named.conf</code> either directly or by
	  including a file containing the key.  After these steps,
	  configure <acronym class="acronym">BIND</acronym> to do
	  <acronym class="acronym">DNSSEC</acronym> validation on queries by editing
	  <code class="filename">named.conf</code> and adding the following to
	  the <code class="literal">options</code> directive:</p><pre class="programlisting">dnssec-enable yes;
dnssec-validation yes;</pre><p>To verify that it is actually working use
	  <span class="application">dig</span> to make a query for a signed
	  zone using the resolver just configured.  A successful reply
	  will contain the <code class="literal">AD</code> flag to indicate the
	  data was authenticated.  Running a query such as</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dig @<em class="replaceable"><code>resolver</code></em> +dnssec se ds </code></strong></pre><p>should return the <acronym class="acronym">DS</acronym>
	  <acronym class="acronym">RR</acronym> for the <code class="literal">.se</code> zone.
	  In the <code class="literal">flags:</code> section the
	  <code class="literal">AD</code> flag should be set, as seen
	  in:</p><pre class="programlisting">...
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1
...</pre><p>The resolver is now capable of authenticating
	  <acronym class="acronym">DNS</acronym> queries.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dns-dnssec-auth"></a>29.7.3.4.2. Authoritative <acronym class="acronym">DNS</acronym> Server
	  Configuration</h5></div></div></div><p>In order to get an authoritative name server to serve a
	  <acronym class="acronym">DNSSEC</acronym> signed zone a little more work is
	  required.  A zone is signed using cryptographic keys which
	  must be generated.  It is possible to use only one key for
	  this.  The preferred method however is to have a strong
	  well-protected Key Signing Key
	  (<acronym class="acronym">KSK</acronym>) that is
	  not rotated very often and a Zone Signing Key
	  (<acronym class="acronym">ZSK</acronym>) that is
	  rotated more frequently.  Information on recommended
	  operational practices can be found in <a class="link" href="http://tools.ietf.org/rfc/rfc4641.txt" target="_top"><acronym class="acronym">RFC</acronym>
	    4641: <acronym class="acronym">DNSSEC</acronym> Operational
	    Practices</a>.  Practices regarding the root zone can
	  be found in <a class="link" href="http://www.root-dnssec.org/wp-content/uploads/2010/06/icann-dps-00.txt" target="_top"><acronym class="acronym">DNSSEC</acronym>
	    Practice Statement for the Root Zone
	  <acronym class="acronym">KSK</acronym> operator</a> and <a class="link" href="http://www.root-dnssec.org/wp-content/uploads/2010/06/vrsn-dps-00.txt" target="_top"><acronym class="acronym">DNSSEC</acronym>
	    Practice Statement for the Root Zone
	  <acronym class="acronym">ZSK</acronym> operator</a>.  The
	  <acronym class="acronym">KSK</acronym> is used to
	  build a chain of authority to the data in need of validation
	  and as such is also called a Secure Entry Point
	  (<acronym class="acronym">SEP</acronym>) key.  A
	  message digest of this key, called a Delegation Signer
	  (<acronym class="acronym">DS</acronym>) record,
	  must be published in the parent zone to establish the trust
	  chain.  How this is accomplished depends on the parent zone
	  owner.  The <acronym class="acronym">ZSK</acronym>
	  is used to sign the zone, and only needs to be published
	  there.</p><p>To enable <acronym class="acronym">DNSSEC</acronym> for the <code class="systemitem">example.com</code> zone
	  depicted in previous examples, the first step is to use
	  <span class="application">dnssec-keygen</span> to generate the
	  <acronym class="acronym">KSK</acronym> and <acronym class="acronym">ZSK</acronym> key pair.
	  This key pair can utilize different cryptographic
	  algorithms.  It is recommended to use RSA/SHA256 for the
	  keys and 2048 bits key length should be enough.  To generate
	  the <acronym class="acronym">KSK</acronym> for <code class="systemitem">example.com</code>, run</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dnssec-keygen -f KSK -a RSASHA256 -b 2048 -n ZONE example.com</code></strong></pre><p>and to generate the <acronym class="acronym">ZSK</acronym>, run</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dnssec-keygen -a RSASHA256 -b 2048 -n ZONE example.com</code></strong></pre><p><span class="application">dnssec-keygen</span> outputs two
	  files, the public and the private keys in files named
	  similar to <code class="filename">Kexample.com.+005+nnnnn.key</code>
	  (public) and
	  <code class="filename">Kexample.com.+005+nnnnn.private</code>
	  (private).  The <code class="literal">nnnnn</code> part of the file
	  name is a five digit key ID.  Keep track of which key ID
	  belongs to which key.  This is especially important when
	  having more than one key in a zone.  It is also possible to
	  rename the keys.  For each <acronym class="acronym">KSK</acronym> file
	  do:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mv Kexample.com.+005+nnnnn.key Kexample.com.+005+nnnnn.KSK.key</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>mv Kexample.com.+005+nnnnn.private Kexample.com.+005+nnnnn.KSK.private</code></strong></pre><p>For the <acronym class="acronym">ZSK</acronym> files, substitute
	  <code class="literal">KSK</code> for <code class="literal">ZSK</code> as
	  necessary.  The files can now be included in the zone file,
	  using the <code class="literal">$include</code> statement.  It should
	  look something like this:</p><pre class="programlisting">$include Kexample.com.+005+nnnnn.KSK.key ; KSK
$include Kexample.com.+005+nnnnn.ZSK.key    ; ZSK</pre><p>Finally, sign the zone and tell <acronym class="acronym">BIND</acronym>
	  to use the signed zone file.  To sign a zone
	  <span class="application">dnssec-signzone</span> is used.  The
	  command to sign the zone <code class="systemitem">example.com</code>, located in
	  <code class="filename">example.com.db</code> would look similar
	  to</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dnssec-signzone -o
	example.com -k Kexample.com.+005+nnnnn.KSK example.com.db
	Kexample.com.+005+nnnnn.ZSK.key</code></strong></pre><p>The key supplied to the <code class="option">-k</code> argument is
	  the <acronym class="acronym">KSK</acronym> and the other key file is the
	  <acronym class="acronym">ZSK</acronym> that should be used in the signing.
	  It is possible to supply more than one
	  <acronym class="acronym">KSK</acronym> and <acronym class="acronym">ZSK</acronym>, which
	  will result in the zone being signed with all supplied keys.
	  This can be needed to supply zone data signed using more
	  than one algorithm.  The output of
	  <span class="application">dnssec-signzone</span> is a zone file
	  with all <acronym class="acronym">RR</acronym>s signed.  This output will
	  end up in a file with the extension
	  <code class="literal">.signed</code>, such as
	  <code class="filename">example.com.db.signed</code>.  The
	  <acronym class="acronym">DS</acronym> records will
	  also be written to a separate file
	  <code class="filename">dsset-example.com</code>.  To use this signed
	  zone just modify the zone directive in
	  <code class="filename">named.conf</code> to use
	  <code class="filename">example.com.db.signed</code>.  By default, the
	  signatures are only valid 30 days, meaning that the zone
	  needs to be resigned in about 15 days to be sure that
	  resolvers are not caching records with stale signatures.  It
	  is possible to make a script and a cron job to do this.  See
	  relevant manuals for details.</p><p>Be sure to keep private keys confidential, as with all
	  cryptographic keys.  When changing a key it is best to
	  include the new key into the zone, while still signing with
	  the old one, and then move over to using the new key to
	  sign.  After these steps are done the old key can be removed
	  from the zone.  Failure to do this might render the
	  <acronym class="acronym">DNS</acronym> data unavailable for a time, until
	  the new key has propagated through the
	  <acronym class="acronym">DNS</acronym> hierarchy.  For more information on
	  key rollovers and other <acronym class="acronym">DNSSEC</acronym>
	  operational issues, see <a class="link" href="http://www.ietf.org/rfc/rfc4641.txt" target="_top"><acronym class="acronym">RFC</acronym>
	    4641: <acronym class="acronym">DNSSEC</acronym> Operational
	    practices</a>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77398688"></a>29.7.3.4.3. Automation Using <acronym class="acronym">BIND</acronym> 9.7 or
	  Later</h5></div></div></div><p>Beginning with <acronym class="acronym">BIND</acronym> version 9.7 a new
	  feature called <span class="emphasis"><em>Smart Signing</em></span> was
	  introduced.  This feature aims to make the key management
	  and signing process simpler by automating parts of the task.
	  By putting the keys into a directory called a
	  <span class="emphasis"><em>key repository</em></span>, and using the new
	  option <code class="literal">auto-dnssec</code>, it is possible to
	  create a dynamic zone which will be resigned as needed.  To
	  update this zone use <span class="application">nsupdate</span>
	  with the new option <code class="option">-l</code>.
	  <span class="application">rndc</span> has also grown the ability
	  to sign zones with keys in the key repository, using the
	  option <code class="option">sign</code>.  To tell
	  <acronym class="acronym">BIND</acronym> to use this automatic signing and
	  zone updating for <code class="systemitem">example.com</code>, add the
	  following to <code class="filename">named.conf</code>:</p><pre class="programlisting">zone example.com {
	type master;
	key-directory "/etc/named/keys";
	update-policy local;
	auto-dnssec maintain;
	file "/etc/named/dynamic/example.com.zone";
};</pre><p>After making these changes, generate keys for the zone
	  as explained in <a class="xref" href="network-dns.html#dns-dnssec-auth" title="29.7.3.4.2. Authoritative DNS Server Configuration">Section 29.7.3.4.2, &#8220;Authoritative <acronym class="acronym">DNS</acronym> Server
	  Configuration&#8221;</a>, put those
	  keys in the key repository given as the argument to the
	  <code class="literal">key-directory</code> in the zone configuration
	  and the zone will be signed automatically.  Updates to a
	  zone configured this way must be done using
	  <span class="application">nsupdate</span>, which will take care of
	  re-signing the zone with the new data added.  For further
	  details, see <a class="xref" href="network-dns.html#dns-read" title="29.7.3.6. Further Reading">Section 29.7.3.6, &#8220;Further Reading&#8221;</a> and the
	  <acronym class="acronym">BIND</acronym> documentation.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77411744"></a>29.7.3.5. Security</h4></div></div></div><p>Although BIND is the most common implementation of
	<acronym class="acronym">DNS</acronym>, there is always the issue of security.
	Possible and exploitable security holes are sometimes
	found.</p><p>While FreeBSD automatically drops
	<span class="application">named</span> into a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chroot</span>(8)</span></a>
	environment; there are several other security mechanisms in
	place which could help to lure off possible
	<acronym class="acronym">DNS</acronym> service attacks.</p><p>It is always good idea to read
	<a class="link" href="http://www.cert.org/" target="_top">CERT</a>'s security
	advisories and to subscribe to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications" target="_top">FreeBSD security notifications mailing list</a>
	to stay up to date with the current Internet and FreeBSD security
	issues.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">If a problem arises, keeping sources up to date and
	  having a fresh build of <span class="application">named</span>
	  may help.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dns-read"></a>29.7.3.6. Further Reading</h4></div></div></div><p>BIND/<span class="application">named</span> manual pages:
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rndc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rndc</span>(8)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=named&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">named</span>(8)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=named.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">named.conf</span>(5)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nsupdate&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">nsupdate</span>(1)</span></a>
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dnssec-signzone&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dnssec-signzone</span>(8)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dnssec-keygen&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dnssec-keygen</span>(8)</span></a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="https://www.isc.org/software/bind" target="_top">Official
	      ISC BIND Page</a></p></li><li class="listitem"><p><a class="link" href="https://www.isc.org/software/guild" target="_top">Official
	      ISC BIND Forum</a></p></li><li class="listitem"><p><a class="link" href="http://www.oreilly.com/catalog/dns5/" target="_top">O'Reilly
	      <acronym class="acronym">DNS</acronym> and BIND 5th
	      Edition</a></p></li><li class="listitem"><p><a class="link" href="http://www.root-dnssec.org/documentation/" target="_top">Root
	      <acronym class="acronym">DNSSEC</acronym></a></p></li><li class="listitem"><p><a class="link" href="http://data.iana.org/root-anchors/draft-icann-dnssec-trust-anchor.html" target="_top"><acronym class="acronym">DNSSEC</acronym>
	      Trust Anchor Publication for the Root
	      Zone</a></p></li><li class="listitem"><p><a class="link" href="http://tools.ietf.org/html/rfc1034" target="_top">RFC1034
	      - Domain Names - Concepts and Facilities</a></p></li><li class="listitem"><p><a class="link" href="http://tools.ietf.org/html/rfc1035" target="_top">RFC1035
	      - Domain Names - Implementation and
	      Specification</a></p></li><li class="listitem"><p><a class="link" href="http://tools.ietf.org/html/rfc4033" target="_top">RFC4033
	      - <acronym class="acronym">DNS</acronym> Security Introduction and
	      Requirements</a></p></li><li class="listitem"><p><a class="link" href="http://tools.ietf.org/html/rfc4034" target="_top">RFC4034
	      - Resource Records for the <acronym class="acronym">DNS</acronym>
	      Security Extensions</a></p></li><li class="listitem"><p><a class="link" href="http://tools.ietf.org/html/rfc4035" target="_top">RFC4035
	      - Protocol Modifications for the <acronym class="acronym">DNS</acronym>
	      Security Extensions</a></p></li><li class="listitem"><p><a class="link" href="http://tools.ietf.org/html/rfc4641" target="_top">RFC4641
	      - DNSSEC Operational Practices</a></p></li><li class="listitem"><p><a class="link" href="http://tools.ietf.org/html/rfc5011" target="_top">RFC 5011
	      - Automated Updates of <acronym class="acronym">DNS</acronym> Security
	      (<acronym class="acronym">DNSSEC</acronym>
	      Trust Anchors</a></p></li></ul></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-dhcp.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="network-apache.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">29.6. Dynamic Host Configuration Protocol
      (<acronym class="acronym">DHCP</acronym>) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 29.8. Apache HTTP Server</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>