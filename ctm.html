<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>A.3. Using CTM</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Handbook" /><link rel="up" href="mirrors.html" title="Appendix A. Obtaining FreeBSD" /><link rel="prev" href="mirrors-ftp.html" title="A.2. FTP Sites" /><link rel="next" href="svn.html" title="A.4. Using Subversion" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="../../layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">A.3. Using CTM</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mirrors-ftp.html">Prev</a> </td><th width="60%" align="center">Appendix A. Obtaining FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="svn.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ctm"></a>A.3. Using CTM</h2></div></div></div><a id="idp81218976" class="indexterm"></a><p><span class="application">CTM</span> is a method for keeping a
      remote directory tree in sync with a central one.  It is built
      into FreeBSD and can be used to synchronize a system with FreeBSD's
      source repositories.  It supports synchronization of an entire
      repository or just a specified set of branches.</p><p><span class="application">CTM</span> is specifically designed for
      use on lousy or non-existent TCP/IP connections and provides
      the ability for changes to be automatically sent by email.  It
      requires the user to obtain up to three deltas per day for the
      most active branches.  Update sizes are always kept as small as
      possible and are typically less than 5K.  About one in very ten
      updates is 10-50K in size, and there will occasionally be an
      update larger than 100K+.</p><p>When using <span class="application">CTM</span> to track FreeBSD
      development, refer to the caveats related to working directly
      from the development sources rather than a pre-packaged release.
      These are discussed in <a class="link" href="current-stable.html" title="24.4. Tracking a Development Branch">Tracking
	a Development Branch</a>.</p><p>Little documentation exists on the process of creating
      deltas or using <span class="application">CTM</span> for other
      purposes.  Contact the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/ctm-users" target="_top">ctm-users</a> mailing list for
      answers to questions on using
      <span class="application">CTM</span>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirrors-ctm"></a>A.3.1. Getting Deltas</h3></div></div></div><p>The <span class="quote">&#8220;<span class="quote">deltas</span>&#8221;</span> used by
	<span class="application">CTM</span> can be obtained either through
	anonymous <acronym class="acronym">FTP</acronym> or email.</p><p><acronym class="acronym">FTP</acronym> deltas can be obtained from the
	following mirror sites.  When using anonymous
	<acronym class="acronym">FTP</acronym> to obtain
	<span class="application">CTM</span> deltas, select a mirror that is
	geographically nearby.  In case of problems, contact the
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/ctm-users" target="_top">ctm-users</a> mailing list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">California, Bay Area, official source</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/development/CTM/" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/development/CTM/</a></code></p></li><li class="listitem"><p><code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/CTM/" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/CTM/</a></code></p></li></ul></div></dd><dt><span class="term">South Africa, backup server for old deltas</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="uri"><a class="uri" href="ftp://ftp.za.FreeBSD.org/pub/FreeBSD/CTM/" target="_top">ftp://ftp.za.FreeBSD.org/pub/FreeBSD/CTM/</a></code></p></li></ul></div></dd><dt><span class="term">Taiwan/R.O.C.</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="uri"><a class="uri" href="ftp://ctm.tw.FreeBSD.org/pub/FreeBSD/development/CTM/" target="_top">ftp://ctm.tw.FreeBSD.org/pub/FreeBSD/development/CTM/</a></code></p></li><li class="listitem"><p><code class="uri"><a class="uri" href="ftp://ctm2.tw.FreeBSD.org/pub/FreeBSD/development/CTM/" target="_top">ftp://ctm2.tw.FreeBSD.org/pub/FreeBSD/development/CTM/</a></code></p></li><li class="listitem"><p><code class="uri"><a class="uri" href="ftp://ctm3.tw.FreeBSD.org/pub/FreeBSD/development/CTM/" target="_top">ftp://ctm3.tw.FreeBSD.org/pub/FreeBSD/development/CTM/</a></code></p></li></ul></div></dd></dl></div><p>To instead receive deltas through email, subscribe to one
	of the <code class="literal">ctm-src</code> distribution lists available
	from <code class="uri"><a class="uri" href="http://lists.freebsd.org/mailman/listinfo" target="_top">http://lists.freebsd.org/mailman/listinfo</a></code>.
	For example, <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/ctm-src-cur" target="_top">ctm-src-cur</a> supports the head
	development branch and  <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/ctm-src-9" target="_top">ctm-src-9</a> supports the 9.X
	release branch.</p><p>As <span class="application">CTM</span> updates arrive through
	email, use <code class="command">ctm_rmail</code> to unpack and apply
	them.  This command can be run directly from an entry in
	<code class="filename">/etc/aliases</code> in order to automate this
	process.  Refer to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ctm_rmail&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ctm_rmail</span>(1)</span></a> for more details.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Regardless of the method which is used to get deltas,
	  <span class="application">CTM</span> users should subscribe
	  to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/ctm-announce" target="_top">ctm-announce</a> mailing list as this is the
	  only mechanism by which <span class="application">CTM</span>
	  announcements are posted.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81263008"></a>A.3.2. <span class="application">CTM</span> Usage</h3></div></div></div><p>Before <span class="application">CTM</span> deltas can be used
	for the first time, a starting point must be produced.</p><p>One method is to apply a <span class="quote">&#8220;<span class="quote">starter</span>&#8221;</span> delta to
	an empty directory.  A  starter delta can be recognized by the
	<code class="filename">XEmpty</code> in its name, such as
	<code class="filename">src-cur.3210XEmpty.gz</code>.  The designation
	following the <code class="literal">X</code> corresponds to the origin
	of the initial <span class="quote">&#8220;<span class="quote">seed</span>&#8221;</span>, where
	<code class="filename">Empty</code> is an empty directory.  As a rule,
	a base transition from <code class="literal">Empty</code> is produced
	every 100 deltas.  Be aware that starter deltas are large and
	70 to 80 Megabytes of <code class="command">gzip</code>'d data is common
	for the <code class="filename">XEmpty</code> deltas.</p><p>Another method is to copy or extract an initial source
	from  a RELEASE media as this can  save a significant transfer
	of data from the Internet.</p><p>Once a base delta has been created, apply all deltas with
	higher numbers.  To apply the deltas:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /directory/to/store/the/stuff</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ctm -v -v /directory/which/stores/the/deltas/src-xxx.*</code></strong></pre><p>Multiple deltas can be applied with a single command as
	they will be processed one at a time and any deltas that are
	already applied will be ignored.
	<span class="application">CTM</span> understands
	<code class="command">gzip</code> compressed deltas, which saves disk
	space.</p><p>To verify a delta without applying it, include
	<code class="option">-c</code> in the command line.
	<span class="application">CTM</span> will not actually modify the
	local tree but will instead verify the integrity of the delta
	to see if it would apply cleanly.  Refer to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ctm&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ctm</span>(1)</span></a> for
	more information about available options and an overview of
	the process <span class="application">CTM</span> uses when applying
	deltas.</p><p>To keep the local source tree up-to-date, every time a
	new delta becomes available, apply it through
	<span class="application">CTM</span>.</p><p>Once applied, it is recommended to not delete the deltas
	if it is a burden to download them again.  This way, a local
	copy is available in case it is needed for future disaster
	recovery.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81275808"></a>A.3.3. Keeping Local Changes</h3></div></div></div><p>Developers often experiment with and
	change files in their local source tree.
	<span class="application">CTM</span> supports local modifications in
	a limited way: before checking for the presence of a file,
	it first looks for a file with the same name and a
	<code class="filename">.ctm</code> extension.  If this file exists,
	<span class="application">CTM</span> will operate on it instead of
	the original filename.</p><p>This behavior provides a simple way to maintain local
	changes.  Before modifying a file, make a copy with a
	<code class="filename">.ctm</code> suffix.  Make any changes to the
	original filename, knowing that
	<span class="application">CTM</span> will only apply updates to the
	file with the <code class="filename">.ctm</code> suffix.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81287968"></a>A.3.4. Other <span class="application">CTM</span> Options</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Finding Out Exactly What Would Be Touched by an
	    Update</span></dt><dd><p>To determine the list of changes that
	      <span class="application">CTM</span> will make to the local
	      source repository, use <code class="option">-l</code>.  This option
	      is useful for creating logs of the changes or when
	      performing pre- or post-processing on any of the
	      modified files.</p></dd><dt><span class="term">Making Backups Before Updating</span></dt><dd><p>To backup all of the files that would be changed by
	      a <span class="application">CTM</span> update, specify
	      <code class="option">-B
		<em class="replaceable"><code>backup-file</code></em></code>.  This
	      option tells <span class="application">CTM</span> to backup
	      all files touched by the applied
	      <span class="application">CTM</span> delta to
	      <code class="filename">backup-file</code>.</p></dd><dt><span class="term">Restricting the Files Touched by an Update</span></dt><dd><p>To restrict the scope of a given
	      <span class="application">CTM</span> update, or to extract
	      just a few files from a sequence of deltas, filtering
	      regular expressions can be specified using
	      <code class="option">-e</code>, which specifies which files to
	      process, or <code class="option">-x</code>, which specifies which
	      files to ignore.</p><p>For example, to extract an up-to-date copy of
	      <code class="filename">lib/libc/Makefile</code> from a collection
	      of saved <span class="application">CTM</span> deltas:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /directory/to/extract/to/</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ctm -e '^lib/libc/Makefile' /directory/which/stores/the/deltas/src-xxx.*</code></strong></pre><p>For every file specified in a
	      <span class="application">CTM</span> delta,
	      <code class="option">-e</code> and <code class="option">-x</code> are
	      applied in the order given on the command line.  A file
	      is processed by <span class="application">CTM</span> only if
	      it is marked as eligible after all <code class="option">-e</code>
	      and <code class="option">-x</code> options are applied.</p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mirrors-ftp.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="mirrors.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="svn.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">A.2. <acronym class="acronym">FTP</acronym> Sites </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> A.4. Using <span class="application">Subversion</span></td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>